# Mirror Bridge - Single-Header Versions

This directory contains single-header amalgamated versions of Mirror Bridge for each supported language. These are generated by the `amalgamate.sh` script in the root directory.

## Files

| File | Language | Size | Description |
|------|----------|------|-------------|
| `mirror_bridge_python.hpp` | Python | ~1771 lines | Python C API bindings |
| `mirror_bridge_lua.hpp` | Lua | ~859 lines | Lua C API bindings |
| `mirror_bridge_javascript.hpp` | JavaScript | ~875 lines | Node.js N-API bindings |

## Advantages

✅ **Single file** - Copy one header to your project
✅ **No dependencies** - Just include and use
✅ **Self-contained** - Core + language bindings in one file
✅ **Easy distribution** - Share a single file
✅ **Simpler build** - No need to manage multiple includes

## Usage

### Python

```cpp
#include "mirror_bridge_python.hpp"

struct MyClass {
    double value = 0.0;
    double add(double x) { value += x; return value; }
};

MIRROR_BRIDGE_MODULE(my_module,
    mirror_bridge::bind_class<MyClass>(m, "MyClass");
)
```

Compile:
```bash
clang++ -std=c++2c -freflection -freflection-latest -stdlib=libc++ \
    -fPIC -shared $(python3-config --includes --ldflags) \
    binding.cpp -o my_module.so
```

### Lua

```cpp
#include "mirror_bridge_lua.hpp"

struct MyClass {
    double value = 0.0;
    double add(double x) { value += x; return value; }
};

MIRROR_BRIDGE_LUA_MODULE(my_module,
    mirror_bridge::lua::bind_class<MyClass>(L, "MyClass");
)
```

Compile:
```bash
clang++ -std=c++2c -freflection -freflection-latest -stdlib=libc++ \
    -I/usr/include/lua5.4 -fPIC -shared \
    binding.cpp -o my_module.so -llua5.4
```

### JavaScript (Node.js)

```cpp
#include "mirror_bridge_javascript.hpp"

struct MyClass {
    double value = 0.0;
    double add(double x) { value += x; return value; }
};

MIRROR_BRIDGE_JS_MODULE(my_module,
    mirror_bridge::javascript::bind_class<MyClass>(env, m, "MyClass");
)
```

Compile:
```bash
clang++ -std=c++2c -freflection -freflection-latest -stdlib=libc++ \
    -I/usr/include/node -fPIC -shared \
    binding.cpp -o my_module.node
```

## Regeneration

To regenerate these files after updating the main library:

```bash
./amalgamate.sh
```

This will recreate all three single-header files by combining:
- `core/mirror_bridge_core.hpp` (language-agnostic reflection)
- `python/mirror_bridge_python.hpp` or `lua/mirror_bridge_lua.hpp` or `javascript/mirror_bridge_javascript.hpp`

## Testing

The single-header versions are tested in `tests/single_header_test/` with a Robot class example that demonstrates:
- Properties (name, battery, commands)
- Methods (move_forward, get_status, add_command, etc.)
- Containers (vector<string>)
- Multiple parameters
- Void methods

All tests pass for all three languages.

## Multi-Header vs Single-Header

**Use multi-header** (`core/`, `python/`, `lua/`, `javascript/`) when:
- Developing the library itself
- Need to switch between languages easily
- Want clearer separation of concerns

**Use single-header** (`single_header/*.hpp`) when:
- Distributing to end users
- Want simplest possible setup
- Building a project with one language only
- Need a single file to copy

Both versions are functionally identical and produce the same compiled output.
